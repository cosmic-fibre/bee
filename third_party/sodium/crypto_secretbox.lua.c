const char crypto_secretbox_lua[] =
"local ffi = require \"ffi\"\n"
"local lib = ffi.load \"sodium\"\n"
"\n"
"ffi.cdef [[\n"
"size_t crypto_secretbox_xsalsa20poly1305_keybytes(void);\n"
"size_t crypto_secretbox_xsalsa20poly1305_noncebytes(void);\n"
"size_t crypto_secretbox_xsalsa20poly1305_zerobytes(void);\n"
"size_t crypto_secretbox_xsalsa20poly1305_boxzerobytes(void);\n"
"const char * crypto_secretbox_xsalsa20poly1305_primitive(void);\n"
"int crypto_secretbox_xsalsa20poly1305(unsigned char *,const unsigned char *,unsigned long long,const unsigned char *,const unsigned char *);\n"
"int crypto_secretbox_xsalsa20poly1305_open(unsigned char *,const unsigned char *,unsigned long long,const unsigned char *,const unsigned char *);\n"
"size_t crypto_secretbox_keybytes(void);\n"
"size_t crypto_secretbox_noncebytes(void);\n"
"size_t crypto_secretbox_zerobytes(void);\n"
"size_t crypto_secretbox_boxzerobytes(void);\n"
"const char *crypto_secretbox_primitive(void);\n"
"int crypto_secretbox(unsigned char *c, const unsigned char *m,\n"
"                     unsigned long long mlen, const unsigned char *n,\n"
"                     const unsigned char *k);\n"
"int crypto_secretbox_open(unsigned char *m, const unsigned char *c,\n"
"                          unsigned long long clen, const unsigned char *n,\n"
"                          const unsigned char *k);\n"
"]]\n"
"\n"
"local _M = { }\n"
"\n"
"_M.keybytes = function() return tonumber(lib.crypto_secretbox_keybytes()) end\n"
"_M.noncebytes = function() return tonumber(lib.crypto_secretbox_noncebytes()) end\n"
"_M.zerobytes = function() return tonumber(lib.crypto_secretbox_zerobytes()) end\n"
"_M.boxzerobytes = function() return tonumber(lib.crypto_secretbox_boxzerobytes()) end\n"
"_M.primitive = function() return ffi.string(lib.crypto_secretbox_primitive()) end\n"
"_M.secretbox = function(c, m, mlen, n, k)\n"
"\tmlen = mlen or #m\n"
"\tc = c or ffi.new(\"unsigned char[?]\", mlen)\n"
"\tassert(lib.crypto_secretbox(c, m, mlen, n, k) == 0, \"crypto_secretbox returned non-zero\")\n"
"\treturn c, mlen\n"
"end\n"
"_M.open = function(m, c, clen, n, k)\n"
"\tclen = clen or #c\n"
"\tm = m or ffi.new(\"unsigned char[?]\", clen)\n"
"\tassert(lib.crypto_secretbox_open(m, c, clen, n, k) == 0, \"crypto_secretbox_open returned non-zero\")\n"
"\treturn m, clen\n"
"end\n"
"\n"
"return setmetatable ( _M , { __call = function(_M, ...) return _M.secretbox(...) end } )\n"
""
;
