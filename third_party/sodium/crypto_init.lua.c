const char crypto_init_lua[] =
"local ffi = require \"ffi\"\n"
"local lib = ffi.load \"sodium\"\n"
"\n"
"ffi.cdef [[\n"
"int sodium_init(void);\n"
"unsigned char *_sodium_alignedcalloc(unsigned char ** const unaligned_p,\n"
"                                     const size_t len);\n"
"void sodium_memzero(void * const pnt, const size_t len);\n"
"int sodium_memcmp(const void * const b1_, const void * const b2_, size_t size);\n"
"char *sodium_bin2hex(char * const hex, const size_t hexlen,\n"
"                     const unsigned char *bin, const size_t binlen);\n"
"const char *sodium_version_string(void);\n"
"int sodium_library_version_major(void);\n"
"int sodium_library_version_minor(void);\n"
"]]\n"
"\n"
"local _M = { }\n"
"\n"
"_M.init = function()\n"
"\tlocal r = lib.sodium_init()\n"
"\tif r < 0 then error(\"sodium was unable to initialise\") end\n"
"\treturn r > 1\n"
"end\n"
"_M.memzero = lib.sodium_memzero\n"
"_M.memcmp = lib.sodium_memcmp\n"
"_M.bin2hex = function(hex, hexlen, bin, binlen)\n"
"\tbinlen = binlen or #bin\n"
"\thexlen = hexlen or binlen*2\n"
"\thex = hex or ffi.new(\"unsigned char[?]\", hexlen)\n"
"\tlib.sodium_bin2hex(hex, hexlen, bin, binlen)\n"
"\treturn hex, hexlen\n"
"end\n"
"_M.version_string = function() return ffi.string(lib.sodium_version_string()) end\n"
"_M.library_version_major = function() return tonumber(lib.sodium_library_version_major()) end\n"
"_M.library_version_minor = function() return tonumber(lib.sodium_library_version_minor()) end\n"
"\n"
"return _M\n"
""
;
