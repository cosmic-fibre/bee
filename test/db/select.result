s = db.schema.space.create('select', { temporary = true })
---
...
index1 = s:create_index('primary', { type = 'tree' })
---
...
index2 = s:create_index('second', { type = 'tree', unique = true,  parts = {2, 'num', 1, 'num'}})
---
...
for i = 1, 20 do s:insert({ i, 1, 2, 3 }) end
---
...
--------------------------------------------------------------------------------
-- get tests
--------------------------------------------------------------------------------
s.index[0]:get()
---
- error: Invalid key part count in an exact match (expected 1, got 0)
...
s.index[0]:get({})
---
- error: Invalid key part count in an exact match (expected 1, got 0)
...
s.index[0]:get(nil)
---
- error: Invalid key part count in an exact match (expected 1, got 0)
...
s.index[0]:get(1)
---
- [1, 1, 2, 3]
...
s.index[0]:get({1})
---
- [1, 1, 2, 3]
...
s.index[0]:get({1, 2})
---
- error: Invalid key part count in an exact match (expected 1, got 2)
...
s.index[0]:get(0)
---
...
s.index[0]:get({0})
---
...
s.index[0]:get("0")
---
- error: 'Supplied key type of part 0 does not match index part type: expected NUM'
...
s.index[0]:get({"0"})
---
- error: 'Supplied key type of part 0 does not match index part type: expected NUM'
...
s.index[1]:get(1)
---
- error: Invalid key part count in an exact match (expected 2, got 1)
...
s.index[1]:get({1})
---
- error: Invalid key part count in an exact match (expected 2, got 1)
...
s.index[1]:get({1, 2})
---
- [2, 1, 2, 3]
...
--------------------------------------------------------------------------------
-- select tests
--------------------------------------------------------------------------------
s.index[0]:select()
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select({})
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select(nil)
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select({}, {iterator = 'ALL'})
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select(nil, {iterator = db.index.ALL })
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select({}, {iterator = db.index.ALL, limit = 10})
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
...
s.index[0]:select(nil, {iterator = db.index.ALL, limit = 0})
---
- []
...
s.index[0]:select({}, {iterator = 'ALL', limit = 1, offset = 15})
---
- - [16, 1, 2, 3]
...
s.index[0]:select(nil, {iterator = 'ALL', limit = 20, offset = 15})
---
- - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select(nil, {iterator = db.index.EQ})
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select({}, {iterator = 'EQ'})
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select(nil, {iterator = 'REQ'})
---
- - [20, 1, 2, 3]
  - [19, 1, 2, 3]
  - [18, 1, 2, 3]
  - [17, 1, 2, 3]
  - [16, 1, 2, 3]
  - [15, 1, 2, 3]
  - [14, 1, 2, 3]
  - [13, 1, 2, 3]
  - [12, 1, 2, 3]
  - [11, 1, 2, 3]
  - [10, 1, 2, 3]
  - [9, 1, 2, 3]
  - [8, 1, 2, 3]
  - [7, 1, 2, 3]
  - [6, 1, 2, 3]
  - [5, 1, 2, 3]
  - [4, 1, 2, 3]
  - [3, 1, 2, 3]
  - [2, 1, 2, 3]
  - [1, 1, 2, 3]
...
s.index[0]:select({}, {iterator = db.index.REQ})
---
- - [20, 1, 2, 3]
  - [19, 1, 2, 3]
  - [18, 1, 2, 3]
  - [17, 1, 2, 3]
  - [16, 1, 2, 3]
  - [15, 1, 2, 3]
  - [14, 1, 2, 3]
  - [13, 1, 2, 3]
  - [12, 1, 2, 3]
  - [11, 1, 2, 3]
  - [10, 1, 2, 3]
  - [9, 1, 2, 3]
  - [8, 1, 2, 3]
  - [7, 1, 2, 3]
  - [6, 1, 2, 3]
  - [5, 1, 2, 3]
  - [4, 1, 2, 3]
  - [3, 1, 2, 3]
  - [2, 1, 2, 3]
  - [1, 1, 2, 3]
...
s.index[0]:select(nil, {iterator = 'EQ', limit = 2, offset = 1})
---
- - [2, 1, 2, 3]
  - [3, 1, 2, 3]
...
s.index[0]:select({}, {iterator = db.index.REQ, limit = 2, offset = 1})
---
- - [19, 1, 2, 3]
  - [18, 1, 2, 3]
...
s.index[0]:select(1)
---
- - [1, 1, 2, 3]
...
s.index[0]:select({1})
---
- - [1, 1, 2, 3]
...
s.index[0]:select({1, 2})
---
- error: Invalid key part count (expected [0..1], got 2)
...
s.index[0]:select(0)
---
- []
...
s.index[0]:select({0})
---
- []
...
s.index[0]:select("0")
---
- error: 'Supplied key type of part 0 does not match index part type: expected NUM'
...
s.index[0]:select({"0"})
---
- error: 'Supplied key type of part 0 does not match index part type: expected NUM'
...
s.index[1]:select(1)
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[1]:select({1})
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[1]:select({1}, {limit = 2})
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
...
s.index[1]:select(1, {iterator = 'EQ'})
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[1]:select({1}, {iterator = db.index.EQ, offset = 16, limit = 2})
---
- - [17, 1, 2, 3]
  - [18, 1, 2, 3]
...
s.index[1]:select({1}, {iterator = db.index.REQ, offset = 16, limit = 2 })
---
- - [4, 1, 2, 3]
  - [3, 1, 2, 3]
...
s.index[1]:select({1, 2}, {iterator = 'EQ'})
---
- - [2, 1, 2, 3]
...
s.index[1]:select({1, 2}, {iterator = db.index.REQ})
---
- - [2, 1, 2, 3]
...
s.index[1]:select({1, 2})
---
- - [2, 1, 2, 3]
...
s.index[0]:select(nil, { iterator = 'ALL', offset = 0, limit = 4294967295 })
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select({}, { iterator = 'ALL', offset = 0, limit = 4294967295 })
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select(1)
---
- - [1, 1, 2, 3]
...
s.index[0]:select(1, { iterator = db.index.EQ })
---
- - [1, 1, 2, 3]
...
s.index[0]:select(1, { iterator = 'EQ' })
---
- - [1, 1, 2, 3]
...
s.index[0]:select(1, { iterator = 'GE' })
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
  - [3, 1, 2, 3]
  - [4, 1, 2, 3]
  - [5, 1, 2, 3]
  - [6, 1, 2, 3]
  - [7, 1, 2, 3]
  - [8, 1, 2, 3]
  - [9, 1, 2, 3]
  - [10, 1, 2, 3]
  - [11, 1, 2, 3]
  - [12, 1, 2, 3]
  - [13, 1, 2, 3]
  - [14, 1, 2, 3]
  - [15, 1, 2, 3]
  - [16, 1, 2, 3]
  - [17, 1, 2, 3]
  - [18, 1, 2, 3]
  - [19, 1, 2, 3]
  - [20, 1, 2, 3]
...
s.index[0]:select(1, { iterator = 'GE', limit = 2 })
---
- - [1, 1, 2, 3]
  - [2, 1, 2, 3]
...
s.index[0]:select(1, { iterator = 'LE', limit = 2 })
---
- - [1, 1, 2, 3]
...
s.index[0]:select(1, { iterator = 'GE', offset = 10, limit = 2 })
---
- - [11, 1, 2, 3]
  - [12, 1, 2, 3]
...
s:select(2)
---
- - [2, 1, 2, 3]
...
s:drop()
---
...
s = db.schema.space.create('select', { temporary = true })
---
...
index = s:create_index('primary', { type = 'tree' })
---
...
local a s:insert{0}
---
...
lots_of_links = {}
---
...
ref_count = 0
---
...
while (true) do table.insert(lots_of_links, s:get{0}) ref_count = ref_count + 1 end
---
- error: Tuple reference counter overflow
...
ref_count
---
- 65534
...
lots_of_links = {}
---
...
s:drop()
---
...
